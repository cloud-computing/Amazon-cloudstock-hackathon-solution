<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Amazon Cloudstock by eLobato</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Amazon Cloudstock</h1>
        <p>Implementation of Amazon DynamoDB and S3 push and retrieval of data using Ruby and Rails and the AWS SDK for Ruby.</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/eLobato/Amazon-cloudstock-hackathon-solution" class="button fork"><strong>Fork On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/eLobato/Amazon-cloudstock-hackathon-solution/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/eLobato/Amazon-cloudstock-hackathon-solution/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>

      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>Cloudstock Amazon DynamoDB &amp; S3 Hackathon.</h1>

<p>This application shows how to create a Ruby on Rails application 
that allows users to add information to a DynamoDB database, and to 
push and retrieve information from an S3 database. I included my own
database names but you should change these for yours. You should change
the initializer for your own secret and access keys.</p>

<h2>Set Up</h2>

<p>To set this up, as we won't use ActiveRecord, call:</p>

<pre><code>rails new your_app_name --skip-active-record
</code></pre>

<p>In order to get the AWS Ruby functionality, add the 'aws-sdk' gem
to your Gemfile and execute 'bundle install' to get everything set up.</p>

<h2>Initializer</h2>

<p>See config/initializers/aws.rb . This gets called when Rails is initiated
and it will log you in, provided you give your Amazon access_key_id and
secret_access_key.</p>

<h2>Model</h2>

<p>Instead of getting functionality from ActiveRecord, we must inherit from
AWS::Record, then:</p>

<pre><code>User &lt; AWS::Record::HashModel 
</code></pre>

<p>The attributes should be defined here, as:</p>

<pre><code>string_attr :id //This is my primary key in DynamoDB, you may have another one
integer_attr :whatever_number
boolean_attr :whatever_boolean, :default =&gt; false
</code></pre>

<p>In order to write information to S3, we use the following command:</p>

<pre><code>AWS::S3.new.buckets[:your_bucket_name].objects[id].write(your_object_in_s3.read)
</code></pre>

<p>And to retrieve it we can use:</p>

<pre><code>AWS::S3.new.buckets[:your_bucket_name].objects[id].url_for(:read)
</code></pre>

<p>Be wary that you should implement some sort of mechanism to avoid making 
too many calls in order to avoid getting to your S3 quota quickly. 
In this example there is a boolean attribute that takes care not to 
call to the database if there is no image.</p>

<h2>View</h2>

<p>I included a file_field caption in the form so that the users
can upload their photos to Amazon S3. This is only done whenever there
is already an id in DynamoDB set for the record (if @user.id).</p>

<p>In order to show this photos I call the user model in index with (user.img)
so that the image is retrieved from S3. Try to call this method only 
if you are sure that the record contains an image so you can avoid 
unnecessary calls to the database.</p>

<h2>Routes</h2>

<p>Default controller redirects to <a href="/user" class="user-mention">@user</a> using the default Rails ids, 
which by convention are just integers. DynamoDB uses ids with hyphens, lowercase
and uppercase alphanumeric characters, so you have to figure out a way
to handle this in routes.rb. A regular expression works well:</p>

<pre><code>resources :your_model, :id =&gt; /[a-z0-9-]*/ 
</code></pre>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/eLobato">eLobato</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
  </body>
</html>